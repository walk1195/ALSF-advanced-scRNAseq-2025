fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Plot each AUC max rank on its own
ggplot2::facet_grid(cols = ggplot2::vars(auc_max_rank)) +
# Use a built-in theme
ggplot2::theme_bw()
?facet_grid)()
?facet_grid()
# Let's throw these into a df
auc_threshold_df <- data.frame(
row.names = c("average", "lower","higher"),
auc_max_rank = c("1%", "0.5%","5%"),
# Grab thresholds associated with each gene set from assignements object
threshold = c(auc_assignments[[1]]$aucThr$selected,
auc_assignments_lower[[1]]$aucThr$selected,
auc_assignments_higher[[1]]$aucThr$selected)
)
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Plot each AUC max rank on its own
ggplot2::facet_grid(cols = ggplot2::vars(auc_max_rank)) +
# Use a built-in theme
ggplot2::theme_bw()
collection_df <- msigdbr(species = "Homo sapiens", category = "H")
head(collection_df)
head(collection_df)
collection_list <- unique(collection_df$gs_name) |>
purrr::map(
# For each gene set
\(gene_set_name) {
collection_df |>
# Subset to the rows in that gene set
dplyr::filter(gs_name == gene_set_name) |>
# Grab the Ensembl gene identifiers
dplyr::pull(ensembl_gene) |>
# Create a GeneSet object
GeneSet(setName = gene_set_name,
geneIdType = ENSEMBLIdentifier())
}
) |>
# Turn the list of GeneSet objects into a GeneSet collection
GeneSetCollection()
# Change the variable names as needed
collection_cell_auc <- AUCell_run(exprMat = counts_matrix,
geneSets = collection_list,
aucMaxRank = auc_max_rank)
collection_cell_auc
str(collection_cell_auc)
collection_auc_df
collection_auc_df <- collection_cell_auc@assays@data$AUC |>
# Transpose
t() |>
# Convert to data frame
as.data.frame()
# Make the barcodes a column
collection_auc_df
collection_auc_df <- collection_cell_auc@assays@data$AUC |>
# Transpose
t() |>
# Convert to data frame
as.data.frame()
# Make the barcodes a column
tibble::rownames_to_column("barcodes")
collection_auc_df <- collection_cell_auc@assays@data$AUC |>
# Transpose
t() |>
# Convert to data frame
as.data.frame()
# Make the barcodes a column
tibble::rownames_to_column("barcodes")
collection_auc_df <- collection_cell_auc@assays@data$AUC |>
# Transpose
t() |>
# Convert to data frame
as.data.frame() |>
# Make the barcodes a column
tibble::rownames_to_column("barcodes")
collection_auc_df
auc_df
auc_df <- auc_df |>
dplyr::inner_join(
collection_auc_df,
by = "barcodes"
)
auc_output_file
auc_output_file <- fs::path(analysis_dir, "ewing_sarcoma_SCPCS000492_Hallmark_results.tsv")
auc_output_file
readr::write_tsv(auc_df, auc_output_file)
auc_df
head(auc_df)
head(colData(sce))
coldata_updated <- colData(sce) |>
dplyr::left_join(auc_df, by = "barcodes")
str(colData(sce))
type(colData(sce))
# Extract colData and join with AUC data frame
coldata_df <- colData(sce) |>
as.data.frame() |>
dplyr::left_join(auc_df, by = "barcodes")
# Add a DataFrame back to colData
head(coldata_df)
# Extract colData and join with AUC data frame
coldata_df <- colData(sce) |>
as.data.frame() |>
dplyr::left_join(auc_df, by = "barcodes")
# Add a DataFrame back to colData
colData(sce) <- DataFrame(
coldata_df,
row.names = colData(sce)$barcodes
)
colnames(colData(sce))
scater::plotUMAP(
sce,
color_by = "tumor_cell",
)
auc_df
?scater::plotReducedDim
colnames(colData(sce))
pathway_to_plot <- "HALLMARK_MYC_TARGETS_V1"
sce
scater::plotReducedDim(
sce,
dimred = "UMAP",
color_by = pathway_to_plot,
shape = "tumor_cell"
) +
ggplot2::ggtitle(stringr::str_replace_all(pathway_to_plot,
"\\_",
" "))
scater::plotUMAP(sce,
shape_by = "tumor_cell",
colour_by = pathway_to_plot,
other_fields = "tumor_cell") +
ggplot2::facet_wrap(ggplot2::vars(tumor_cell), ncol = 1) +
ggplot2::coord_fixed()  # Keep the plots square
auc_threshold_df
auc_df_higher
auc_df_longer |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Plot each AUC max rank on its own
ggplot2::facet_grid(cols = ggplot2::vars(auc_max_rank)) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df_lower |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Plot each AUC max rank on its own
ggplot2::facet_grid(cols = ggplot2::vars(auc_max_rank)) +
# Use a built-in theme
ggplot2::theme_bw()
colnames(auc_df)
colnames(auc_df_higher)
?dplyr::left_join
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes")
auc_df_combined
head(auc_df_combined)
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05"))
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05"))
head(auc_df_combined)
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05")) |>
dplyr::left_join(auc_df, by = "barcodes", keep = c("tumor_marker_genes", "tumor_cell"))
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05")) |>
dplyr::left_join(auc_df, by = "barcodes", keep = c("tumor_marker_genes", "tumor_cell"), suffix = c("", "_0.1"))
head(auc_df[1:3,])
head(auc_df[,1:3])
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05")) |>
dplyr::left_join(auc_df[,1:3], by = "barcodes", suffix = c("", "_0.1"))
auc_df_combined
head(auc_df_combined)
head(auc_df[,1:3])
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05")) |>
dplyr::left_join(auc_df[,1:3], by = "barcodes", suffix = c("", "_0.1"))
head(auc_df_combined)
# We also need to merge our results from each run, changing the colnames to specify which run
auc_df_combined <- auc_df_higher |>
dplyr::left_join(auc_df_lower, by = "barcodes", suffix = c("_0.5", "_0.05")) |>
dplyr::left_join(auc_df[,1:3], by = "barcodes", suffix = c("test", "_0.1"))
head(auc_df_combined)
auc_threshold_df
auc_df_lower |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Plot each AUC max rank on its own
ggplot2::facet_grid(cols = ggplot2::vars(auc_max_rank)) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2)
# Use a built-in theme
ggplot2::theme_bw()
pathway_to_plot
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = "HALLMARK_TGF_BETA_SIGNALING",
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df$HALLMARK_MYC_TARGETS_V1
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
# Use a built-in theme
ggplot2::theme_bw()
auc_df$tumor_cell
auc_df$tumor_marker_genes
head(auc_df$tumor_marker_genes)
head(auc_df$HALLMARK_MYC_TARGETS_V1)
length(auc_df$HALLMARK_MYC_TARGETS_V1)
length(auc_df$tumor_marker_genes)
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
#  ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = pathway_to_plot,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = HALLMARK_MYC_TARGETS_V1,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
sessionInfo()
auc_df
str(auc_df)
threshold
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
#  ggplot2::geom_vline(data = auc_threshold_df,
#                      mapping = ggplot2::aes(xintercept = threshold),
#                      lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_threshold_df
?ggplot2::geom_vline
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_threshold_df
auc_threshold_df$threshold
auc_threshold_df$threshold[0]
auc_threshold_df$threshold[1]
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[1]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df_higher |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[3]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw()
auc_df_higher |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[3]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw() +
ggtitle("AUC Tumor Cell Assignment, Max Rank Threshold = 5%")
auc_df_higher |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[3]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw() +
ggplot2::ggtitle("AUC Tumor Cell Assignment, Max Rank Threshold = 5%")
auc_df |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[1]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw() +
ggplot2::ggtitle("AUC Tumor Cell Assignment, Max Rank Threshold = 1%")
auc_df_lower |>
ggplot2::ggplot(
ggplot2::aes(
x = tumor_marker_genes,
color = tumor_cell,
fill = tumor_cell,
)
) +
ggplot2::geom_density(alpha = 0.2) +
# Draw a vertical dotted line showing the threshold
ggplot2::geom_vline(data = auc_threshold_df,
mapping = ggplot2::aes(xintercept = threshold[2]),
lty = 2) +
# Use a built-in theme
ggplot2::theme_bw() +
ggplot2::ggtitle("AUC Tumor Cell Assignment, Max Rank Threshold = 0.5%")
cell_auc
str(cell_auc)
# We will be loading a SingleCellExperiment object into our environment but don't need to see the startup messages
suppressPackageStartupMessages({
library(SingleCellExperiment)
})
# Library we'll use for the gene set analysis itself
library(AUCell)
# Libraries for accessing and working with gene sets
library(GSEABase)
library(msigdbr)
# We will be loading a SingleCellExperiment object into our environment but don't need to see the startup messages
suppressPackageStartupMessages({
library(SingleCellExperiment)
})
# Library we'll use for the gene set analysis itself
library(AUCell)
# Libraries for accessing and working with gene sets
library(GSEABase)
library(msigdbr)
